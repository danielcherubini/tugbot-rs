{
  "variables": {
    "proxmox_url": "{{env `PROXMOX_URL`}}",
    "proxmox_username": "{{env `PROXMOX_USERNAME`}}",
    "proxmox_token": "{{env `PROXMOX_TOKEN`}}",
    "discord_token": "{{env `DISCORD_TOKEN`}}",
    "discord_application_id": "{{env `DISCORD_APPLICATION_ID`}}"
  },

  "builders": [
    {
      "type": "proxmox-clone",
      "proxmox_url": "{{user `proxmox_url`}}",
      "username": "{{user `proxmox_username`}}",
      "token": "{{user `proxmox_token`}}",
      "node": "jove",
      "insecure_skip_tls_verify": true,
      "clone_vm": "debian-11",
      "template_name": "tugbot-template",
      "template_description": "image made from cloud-init image",
      "qemu_agent": true,
      "ssh_username": "root",
      "onboot": true,
      "os": "l26",
      "cores": 4,
      "sockets": 1,
      "memory": 4096,
      "network_adapters": [
        {
          "bridge": "vmbr0"
        }
      ]
    }
  ],
  "provisioners": [
    {
      "type": "shell",
      "inline": [
        "sudo apt-get -y install git build-essential",
        "curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- --profile minimal -y",
        ". $HOME/.cargo/env",
        "mkdir -p /usr/src/tugbot",
        "git clone https://gitlab.com/danielcherubini/tugbot-rs.git /usr/src/tugbot",
        "cd /usr/src/tugbot",
        "cargo install --path .",
        "echo 'DISCORD_TOKEN={{user `discord_token`}}\nAPPLICATION_ID={{user `discord_application_id`}}' > .env",
        "cp systemd/tugbot.service /etc/systemd/system",
        "systemctl daemon-reload",
        "systemctl enable tugbot.service"
      ]
    }
  ],
  "description": "Tugbot template build"
}
